<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–∫–∞–ª–æ–¥—Ä–æ–º—ã Buenos Aires</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  #map { width: 100%; height: 100vh; }
  .info-panel {
    position: absolute; top: 10px; right: 10px; z-index: 1000;
    background: white; border-radius: 12px; padding: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-width: 320px;
    max-height: 90vh; overflow-y: auto;
  }
  .info-panel h2 { font-size: 18px; margin-bottom: 8px; }
  .info-panel p { font-size: 13px; color: #666; margin-bottom: 12px; }
  .gym-list { list-style: none; }
  .gym-list li {
    padding: 10px 0; border-bottom: 1px solid #eee;
    cursor: pointer; transition: background 0.2s;
  }
  .gym-list li:hover { background: #f5f5f5; margin: 0 -16px; padding: 10px 16px; }
  .gym-list li:last-child { border-bottom: none; }
  .gym-name { font-weight: 700; font-size: 14px; color: #333; }
  .gym-address { font-size: 12px; color: #888; margin-top: 2px; }
  .gym-distance { font-size: 12px; color: #4CAF50; font-weight: 600; margin-top: 2px; }
  .gym-schedule { font-size: 11px; color: #999; margin-top: 2px; }
  .btn-locate {
    width: 100%; padding: 10px; border: none; border-radius: 8px;
    background: #2196F3; color: white; font-size: 14px; font-weight: 600;
    cursor: pointer; margin-bottom: 12px;
  }
  .btn-locate:hover { background: #1976D2; }
  .btn-locate:disabled { background: #ccc; cursor: default; }
  .climb-marker {
    background: #E53935;
    border-radius: 50%;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 2px #E53935;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    line-height: 1;
  }
  .popup-content h3 { margin: 0 0 4px 0; font-size: 15px; }
  .popup-content p { margin: 2px 0; font-size: 12px; color: #555; }
  .popup-content .dist { color: #4CAF50; font-weight: 600; }
  .popup-content a { color: #2196F3; text-decoration: none; }
</style>
</head>
<body>

<div id="map"></div>

<div class="info-panel">
  <h2>üßó –°–∫–∞–ª–æ–¥—Ä–æ–º—ã BA</h2>
  <p>–í—Å–µ indoor —Å–∫–∞–ª–æ–¥—Ä–æ–º—ã –ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å–∞</p>
  <button class="btn-locate" id="locateBtn" onclick="locateUser()">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
  <ul class="gym-list" id="gymList"></ul>
</div>

<script>
const gyms = [
  {
    name: "Realization Escalada",
    address: "Alm. F. J. Segu√≠ 1952, Palermo",
    lat: -34.5883, lng: -58.4350,
    schedule: "–í—Ç-–°–± 10-22, –í—Å 15-22",
    ig: "@realization_escalada",
    url: "https://www.instagram.com/realization_escalada/",
    features: "–ú—É—Ä + boulder + –ø–∞—Ç–∏–æ —Å –ø–∏–≤–æ–º üç∫"
  },
  {
    name: "Club RKM ‚Äî All Boys Saavedra",
    address: "Besares 3142, Saavedra",
    lat: -34.5530, lng: -58.4897,
    schedule: "–£—Ç–æ—á–Ω—è—Ç—å –ø–æ —Ç–µ–ª.",
    phone: "+54 11 4541-8338",
    url: "https://www.facebook.com/clubrkm/",
    features: "–ü–µ—Ä–≤—ã–π –∫–ª—É–± —Å–∫–∞–ª–æ–ª–∞–∑–∞–Ω–∏—è BA (1996). –ú—É—Ä + boulder."
  },
  {
    name: "Bien Alto Escuela de Monta√±a",
    address: "Malabia 538, Villa Crespo",
    lat: -34.5983, lng: -58.4279,
    schedule: "–£—Ç–æ—á–Ω—è—Ç—å",
    phone: "1531713103",
    ig: "@bienaltoescuela",
    features: "–ú—É—Ä –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π + boulder, –∫—É—Ä—Å—ã, –≤—ã–µ–∑–¥—ã –Ω–∞ —Å–∫–∞–ª—ã"
  },
  {
    name: "Punto Cumbre",
    address: "Jean Jaures 351, Balvanera",
    lat: -34.6097, lng: -58.4126,
    schedule: "–°–± —Å–≤–æ–±–æ–¥–Ω–æ–µ –ª–∞–∑–∞–Ω–∏–µ 16-20",
    ig: "@punto_cumbre",
    features: "–í—Å–µ —É—Ä–æ–≤–Ω–∏, –∫—É—Ä—Å—ã, –º—É—Ä libre"
  },
  {
    name: "V_Once Escalada",
    address: "Gral. Urquiza 124, Once",
    lat: -34.6050, lng: -58.4070,
    schedule: "–°–º. Instagram",
    ig: "@v_once_escalada",
    features: "Boulder + cuerda, –∫–∞—Ñ–µ—Ç–µ—Ä–∏—è, day pass"
  },
  {
    name: "Rustik",
    address: "Pje. Rufino 3086, Caballito",
    lat: -34.6170, lng: -58.4350,
    schedule: "–ü–Ω,–í—Ç,–ß—Ç,–°–± 17-22 / –°—Ä,–ü—Ç 10-13 –∏ 17-22",
    ig: "@escaladarustik",
    features: "Boulder + —à–∫–æ–ª–∞, –∫—É—Ä—Å—ã –¥–ª—è –¥–µ—Ç–µ–π"
  },
  {
    name: "Estaci√≥n Vertical",
    address: "Av. San Mart√≠n 2665, Florida, Vte. L√≥pez",
    lat: -34.5280, lng: -58.4960,
    schedule: "–°–º. Instagram",
    ig: "@estacionvertical",
    url: "https://www.estacionvertical.com.ar/",
    features: "250 –º¬≤ boulder, free practice, –¥–µ—Ç–∏ 4-15"
  },
  {
    name: "Ahonikenk",
    address: "M. Porcel de Peralta 1458, Villa Real",
    lat: -34.6189, lng: -58.5109,
    schedule: "–ü–Ω-–ß—Ç 17-19, –°–± 9-12:30 –∏ 15-20",
    phone: "15-5139-6458",
    features: "9–º –≤—ã—Å–æ—Ç–∞, 15+ –º–∞—Ä—à—Ä—É—Ç–æ–≤, 4 –Ω–∞–≤–∏—Å–∞–Ω–∏—è, outdoor"
  },
  {
    name: "Golem Escalada",
    address: "Brandsen 2255, Avellaneda",
    lat: -34.6620, lng: -58.3660,
    schedule: "–ü–Ω-–ü—Ç 18-22, –°–± 14-16:30",
    ig: "@golem_escalada",
    features: "Boulder + top-rope, –∫—Ä—ã—Ç—ã–µ –∏ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–µ–∫—Ü–∏–∏"
  }
];

// Init map centered on Buenos Aires
const map = L.map('map').setView([-34.58, -58.44], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

const climbIcon = L.divIcon({
  html: 'üßó',
  className: 'climb-marker',
  iconSize: [42, 42],
  iconAnchor: [21, 21]
});

let userMarker = null;
let userPos = null;

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  return R * 2 * Math.asin(Math.sqrt(a));
}

function updateDistances() {
  gyms.forEach(g => {
    g.distance = userPos ? haversine(userPos.lat, userPos.lng, g.lat, g.lng) : null;
  });
  gyms.sort((a, b) => (a.distance || 999) - (b.distance || 999));
  renderList();
}

function renderList() {
  const list = document.getElementById('gymList');
  list.innerHTML = gyms.map((g, i) => `
    <li onclick="flyTo(${g.lat}, ${g.lng}, '${g.name.replace(/'/g, "\\'")}')">
      <div class="gym-name">${g.name}</div>
      <div class="gym-address">üìç ${g.address}</div>
      ${g.distance ? `<div class="gym-distance">üìè ${g.distance.toFixed(1)} –∫–º</div>` : ''}
      <div class="gym-schedule">üïê ${g.schedule}</div>
    </li>
  `).join('');
}

function flyTo(lat, lng, name) {
  map.flyTo([lat, lng], 15);
  gyms.find(g => g.name === name)?._marker?.openPopup();
}

// Add markers
gyms.forEach(g => {
  const popup = `<div class="popup-content">
    <h3>${g.name}</h3>
    <p>üìç ${g.address}</p>
    <p>üïê ${g.schedule}</p>
    <p>${g.features}</p>
    ${g.distance ? `<p class="dist">üìè ${g.distance.toFixed(1)} –∫–º –æ—Ç –≤–∞—Å</p>` : ''}
    ${g.ig ? `<p><a href="https://instagram.com/${g.ig.replace('@','')}" target="_blank">Instagram ${g.ig}</a></p>` : ''}
    ${g.url ? `<p><a href="${g.url}" target="_blank">–°–∞–π—Ç</a></p>` : ''}
    ${g.phone ? `<p>üìû ${g.phone}</p>` : ''}
    <p><a href="https://www.google.com/maps/dir/?api=1&destination=${g.lat},${g.lng}" target="_blank">üó∫ –ú–∞—Ä—à—Ä—É—Ç –≤ Google Maps</a></p>
  </div>`;
  g._marker = L.marker([g.lat, g.lng], {icon: climbIcon}).addTo(map).bindPopup(popup);
});

function locateUser() {
  const btn = document.getElementById('locateBtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ –û–ø—Ä–µ–¥–µ–ª—è—é...';

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([userPos.lat, userPos.lng], {
          icon: L.divIcon({ html: 'üìç', className: '', iconSize: [24, 24], iconAnchor: [12, 12] })
        }).addTo(map).bindPopup('–í—ã –∑–¥–µ—Å—å').openPopup();
        map.flyTo([userPos.lat, userPos.lng], 13);
        updateDistances();
        // Update popups with distances
        gyms.forEach(g => {
          const popup = `<div class="popup-content">
            <h3>${g.name}</h3>
            <p>üìç ${g.address}</p>
            <p>üïê ${g.schedule}</p>
            <p>${g.features}</p>
            <p class="dist">üìè ${g.distance.toFixed(1)} –∫–º –æ—Ç –≤–∞—Å</p>
            ${g.ig ? `<p><a href="https://instagram.com/${g.ig.replace('@','')}" target="_blank">Instagram ${g.ig}</a></p>` : ''}
            ${g.url ? `<p><a href="${g.url}" target="_blank">–°–∞–π—Ç</a></p>` : ''}
            ${g.phone ? `<p>üìû ${g.phone}</p>` : ''}
            <p><a href="https://www.google.com/maps/dir/?api=1&destination=${g.lat},${g.lng}" target="_blank">üó∫ –ú–∞—Ä—à—Ä—É—Ç –≤ Google Maps</a></p>
          </div>`;
          g._marker.setPopupContent(popup);
        });
        btn.textContent = '‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
        setTimeout(() => { btn.textContent = 'üìç –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'; btn.disabled = false; }, 2000);
      },
      err => {
        btn.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å';
        btn.disabled = false;
        setTimeout(() => { btn.textContent = 'üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'; }, 2000);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }
}

renderList();
</script>
</body>
</html>
