<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–°–∫–∞–ª–æ–¥—Ä–æ–º—ã Buenos Aires</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
  #map { width: 100%; height: 100vh; }
  .info-panel {
    position: absolute; top: 10px; right: 10px; z-index: 1000;
    background: white; border-radius: 12px; padding: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15); max-width: 340px;
    max-height: 90vh; overflow-y: auto;
  }
  .info-panel h2 { font-size: 18px; margin-bottom: 4px; }
  .info-panel .subtitle { font-size: 12px; color: #999; margin-bottom: 8px; }
  .info-panel p { font-size: 13px; color: #666; margin-bottom: 12px; }
  .gym-list { list-style: none; }
  .gym-list li {
    padding: 10px 0; border-bottom: 1px solid #eee;
    cursor: pointer; transition: background 0.2s;
  }
  .gym-list li:hover { background: #f5f5f5; margin: 0 -16px; padding: 10px 16px; }
  .gym-list li:last-child { border-bottom: none; }
  .gym-name { font-weight: 700; font-size: 14px; color: #333; }
  .gym-address { font-size: 12px; color: #888; margin-top: 2px; }
  .gym-distance { font-size: 12px; color: #4CAF50; font-weight: 600; margin-top: 2px; }
  .gym-schedule { font-size: 11px; color: #999; margin-top: 2px; }
  .gym-tag { display: inline-block; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-top: 4px; margin-right: 4px; }
  .tag-caba { background: #E3F2FD; color: #1565C0; }
  .tag-gba { background: #FFF3E0; color: #E65100; }
  .tag-new { background: #E8F5E9; color: #2E7D32; }
  .btn-locate {
    width: 100%; padding: 10px; border: none; border-radius: 8px;
    background: #2196F3; color: white; font-size: 14px; font-weight: 600;
    cursor: pointer; margin-bottom: 12px;
  }
  .btn-locate:hover { background: #1976D2; }
  .btn-locate:disabled { background: #ccc; cursor: default; }
  .climb-marker {
    background: #E53935;
    border-radius: 50%;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4), 0 0 0 2px #E53935;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    line-height: 1;
  }
  .popup-content h3 { margin: 0 0 4px 0; font-size: 15px; }
  .popup-content p { margin: 2px 0; font-size: 12px; color: #555; }
  .popup-content .dist { color: #4CAF50; font-weight: 600; }
  .popup-content a { color: #2196F3; text-decoration: none; }
  .search-row {
    display: flex; gap: 6px; margin-bottom: 6px;
  }
  .search-row input {
    flex: 1; padding: 8px 10px; border: 1px solid #ddd; border-radius: 8px;
    font-size: 13px; outline: none;
  }
  .search-row input:focus { border-color: #2196F3; }
  .btn-search {
    padding: 8px 12px; border: none; border-radius: 8px;
    background: #FF9800; color: white; font-size: 14px; cursor: pointer;
  }
  .btn-search:hover { background: #F57C00; }
  .click-hint {
    font-size: 11px; color: #999; margin-bottom: 10px; text-align: center;
  }
  .custom-marker-pin {
    background: #FF9800;
    border-radius: 50%;
    border: 3px solid #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3), 0 0 0 2px #FF9800;
    display: flex !important;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    line-height: 1;
  }
  .filter-row { display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
  .filter-btn {
    padding: 4px 10px; border: 1px solid #ddd; border-radius: 6px;
    background: white; font-size: 11px; cursor: pointer; transition: all 0.2s;
  }
  .filter-btn.active { background: #2196F3; color: white; border-color: #2196F3; }
</style>
</head>
<body>

<div id="map"></div>

<div class="info-panel">
  <h2>üßó –°–∫–∞–ª–æ–¥—Ä–æ–º—ã BA</h2>
  <div class="subtitle">16 –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π ¬∑ –æ–±–Ω–æ–≤–ª–µ–Ω–æ 21.02.2026</div>
  <p>–í—Å–µ indoor —Å–∫–∞–ª–æ–¥—Ä–æ–º—ã –ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å–∞ –∏ –ø—Ä–∏–≥–æ—Ä–æ–¥–æ–≤</p>
  <div class="filter-row">
    <button class="filter-btn active" onclick="filterGyms('all')">–í—Å–µ (16)</button>
    <button class="filter-btn" onclick="filterGyms('caba')">CABA</button>
    <button class="filter-btn" onclick="filterGyms('gba')">GBA</button>
  </div>
  <button class="btn-locate" id="locateBtn" onclick="locateUser()">üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
  <div class="search-row">
    <input type="text" id="addressInput" placeholder="–ê–¥—Ä–µ—Å –∏–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (-34.60, -58.43)" />
    <button class="btn-search" onclick="searchAddress()">üîç</button>
  </div>
  <div class="click-hint" id="clickHint">üí° –ò–ª–∏ –∫–ª–∏–∫–Ω–∏ –ø–æ –∫–∞—Ä—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å —Ç–æ—á–∫—É</div>
  <ul class="gym-list" id="gymList"></ul>
</div>

<script>
const gyms = [
  {
    name: "Realization Escalada",
    address: "Almte. F. J. Segu√≠ 1952, V. Gral. Mitre",
    lat: -34.6044, lng: -58.4628,
    schedule: "Mar-S√°b 10-22, Dom 15-22",
    ig: "@realizationescalada",
    url: "https://www.realizationescalada.com/",
    phone: "+54 11 6094-8234",
    features: "Boulder + muro, clases, escalada libre, patio cervecero üç∫",
    zone: "caba"
  },
  {
    name: "Club RKM ‚Äî All Boys Saavedra",
    address: "Besares 3142, Saavedra",
    lat: -34.5481, lng: -58.4778,
    schedule: "Consultar por tel/Facebook",
    phone: "+54 11 4541-8338",
    url: "https://www.facebook.com/clubrkm/",
    features: "Primer club de escalada BA (1996). Muro + boulder. Sin fines de lucro.",
    zone: "caba"
  },
  {
    name: "Bien Alto Escuela de Monta√±a",
    address: "Malabia 538, Villa Crespo",
    lat: -34.5979, lng: -58.4382,
    schedule: "Consultar WhatsApp/web",
    phone: "15-3171-3103",
    ig: "@bienaltoescuela",
    url: "https://bienaltoescuelademontana.com/",
    features: "Muro vertical + aplomado, cursos, escuelita, salidas a roca",
    zone: "caba"
  },
  {
    name: "Punto Cumbre / En Punto",
    address: "Jean Jaures 351, Balvanera",
    lat: -34.6001, lng: -58.4074,
    schedule: "S√°b libre 16-20. Ver IG",
    ig: "@punto_cumbre",
    phone: "+54 9 11 3195-7018",
    features: "Todos los niveles, cursos, escuelita, muro libre, acrobacia",
    zone: "caba"
  },
  {
    name: "En Punto (sede Riobamba)",
    address: "Riobamba 165, Balvanera",
    lat: -34.6076, lng: -58.3933,
    schedule: "Lun-Vie 16-22, Mar-Jue 9-14, S√°b 10-20",
    ig: "@escaloenpunto",
    url: "https://escaloenpunto.com/",
    phone: "+54 11 4162-0521",
    features: "Escalada deportiva, cursos de iniciaci√≥n, boulder",
    zone: "caba",
    isNew: true
  },
  {
    name: "V_Once / V11 Escalada",
    address: "Gral. Urquiza 124, Once",
    lat: -34.6119, lng: -58.4101,
    schedule: "Ver Instagram / web",
    ig: "@v_once_escalada",
    url: "https://v11escalada.com/",
    features: "Boulder + cuerda, coworking, cafeter√≠a, day pass üèóÔ∏è",
    zone: "caba"
  },
  {
    name: "Escalada Rustik",
    address: "Pje. Rufino 3086, Villa Urquiza",
    lat: -34.5701, lng: -58.4927,
    schedule: "Lu,Ma,Ju,S√° 17-22 / Mi,Vi 10-13 y 17-22",
    ig: "@escaladarustik",
    url: "https://escaladarustik.com.ar",
    phone: "+54 11 6035-4276",
    features: "Boulder + escuela, cursos para ni√±os 6-13 a√±os",
    zone: "caba"
  },
  {
    name: "CABA Boulder Bucarelli",
    address: "Bucarelli 1247, Parque Chas",
    lat: -34.5871, lng: -58.4783,
    schedule: "Lun-Vie 17-22, S√°b 17-20:30",
    ig: "@caba.bucarelli",
    url: "https://www.caba.org.ar/boulder/parque-chas/ubicacion-y-horarios",
    features: "Boulder grande, clases adultos/intermedios, escuelita. Centro Andino BA üèîÔ∏è",
    zone: "caba",
    isNew: true
  },
  {
    name: "CABA Palestra CeNARD",
    address: "Cris√≥logo Larralde 1050, N√∫√±ez (CeNARD)",
    lat: -34.5440, lng: -58.4548,
    schedule: "Lun-Vie 17-22, S√°b 17-20:30",
    ig: "@centroandinobuenosaires",
    url: "https://www.caba.org.ar/palestra/ubicacion",
    phone: "011-4381-1566",
    features: "Palestra Nacional ~2400m¬≤, la m√°s grande de Sudam√©rica. Concreto y roca üèõÔ∏è",
    zone: "caba",
    isNew: true
  },
  {
    name: "CABA Boulder Centro",
    address: "Rivadavia 1253, San Nicol√°s",
    lat: -34.6086, lng: -58.3843,
    schedule: "Consultar web CABA",
    ig: "@centroandinobuenosaires",
    url: "https://www.caba.org.ar/",
    features: "Boulder + sede administrativa Centro Andino BA",
    zone: "caba",
    isNew: true
  },
  {
    name: "Ahonikenk ‚Äî Club Triglav",
    address: "M. Porcel de Peralta 1458, Villa Real",
    lat: -34.6219, lng: -58.5294,
    schedule: "Lun-Jue 17-19, S√°b 9-12:30 y 15-20",
    ig: "@ahonikenknr",
    url: "http://ahonikenknr.blogspot.com/",
    phone: "15-5139-6458",
    features: "9m altura, 15+ rutas, 4 nivisamientos, cubo, techo 3m, outdoor",
    zone: "caba"
  },
  {
    name: "Estaci√≥n Vertical",
    address: "Av. San Mart√≠n 2665, Florida, Vte. L√≥pez",
    lat: -34.5307, lng: -58.4977,
    schedule: "Ver Instagram @estacionvertical",
    ig: "@estacionvertical",
    url: "https://www.estacionvertical.com.ar/",
    features: "Boulder m√°s grande de Argentina (250m¬≤+), escalada, cursos, ni√±os 4-15 üèÜ",
    zone: "gba"
  },
  {
    name: "Campus ‚Äî Tierra de Escalada",
    address: "Av. Libertador 981, Vicente L√≥pez",
    lat: -34.5251, lng: -58.4720,
    schedule: "Lun-Vie 17-22, S√°b-Dom 15-20",
    ig: "@campusescalada",
    url: "https://www.campusescalada.com.ar/",
    phone: "4504-1874",
    features: "Muro 13m, 500m¬≤ escalable, 14 descuelgues. Boulder 400m¬≤ con techo 10m üß±",
    zone: "gba",
    isNew: true
  },
  {
    name: "AADED Escalando",
    address: "Elcano 794, Acassuso, San Isidro",
    lat: -34.4715, lng: -58.4926,
    schedule: "Lun-Vie 15-21, S√°b-Dom-Fer 14-18:30",
    ig: "@escalando_peru_beach",
    url: "http://www.escalando.com.ar/",
    phone: "+54 11 4798-2759",
    features: "Primera escuela de escalada de Argentina. Muro m√°s alto del pa√≠s, outdoor junto al r√≠o üåä",
    zone: "gba",
    isNew: true
  },
  {
    name: "Golem Escalada",
    address: "Cnel. Brandsen 2255, Avellaneda",
    lat: -34.6767, lng: -58.3542,
    schedule: "Lun-Vie 18-22, S√°b 14-18:30",
    ig: "@golem_escalada",
    url: "https://www.facebook.com/GolemEscalada/",
    phone: "+54 11 6901-7354",
    features: "Muro indoor + boulder, v√≠as, campus board, fisuras. Cursos alpina/rescate.",
    zone: "gba"
  },
  {
    name: "El Muro Escalada",
    address: "Viamonte 160, Ramos Mej√≠a",
    lat: -34.6442, lng: -58.5583,
    schedule: "Lun-Vie 17-22, S√°b 10-21, Dom 9-15",
    ig: "@elmuroderamos",
    url: "http://www.elmuroescalada.com.ar/",
    phone: "+54 11 4464-2560",
    features: "Escuela de escalada, ni√±os y adultos. Boulder + v√≠as.",
    zone: "gba",
    isNew: true
  }
];

// Init map centered on Buenos Aires
const map = L.map('map').setView([-34.59, -58.45], 12);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

const climbIcon = L.divIcon({
  html: 'üßó',
  className: 'climb-marker',
  iconSize: [42, 42],
  iconAnchor: [21, 21]
});

let userMarker = null;
let userPos = null;
let activeFilter = 'all';

function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLon = (lon2 - lon1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLon/2)**2;
  return R * 2 * Math.asin(Math.sqrt(a));
}

function getFilteredGyms() {
  if (activeFilter === 'all') return gyms;
  return gyms.filter(g => g.zone === activeFilter);
}

function filterGyms(filter) {
  activeFilter = filter;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
  updateDistances();
  // Show/hide markers
  gyms.forEach(g => {
    if (filter === 'all' || g.zone === filter) {
      g._marker.addTo(map);
    } else {
      map.removeLayer(g._marker);
    }
  });
}

function updateDistances() {
  gyms.forEach(g => {
    g.distance = userPos ? haversine(userPos.lat, userPos.lng, g.lat, g.lng) : null;
  });
  renderList();
}

function renderList() {
  const filtered = getFilteredGyms();
  const sorted = [...filtered].sort((a, b) => (a.distance || 999) - (b.distance || 999));
  const list = document.getElementById('gymList');
  list.innerHTML = sorted.map(g => `
    <li onclick="flyTo(${g.lat}, ${g.lng}, '${g.name.replace(/'/g, "\\'")}')">
      <div class="gym-name">${g.name}</div>
      <div class="gym-address">üìç ${g.address}</div>
      ${g.distance ? `<div class="gym-distance">üìè ${g.distance.toFixed(1)} –∫–º</div>` : ''}
      <div class="gym-schedule">üïê ${g.schedule}</div>
      <span class="gym-tag ${g.zone === 'caba' ? 'tag-caba' : 'tag-gba'}">${g.zone === 'caba' ? 'CABA' : 'GBA'}</span>
      ${g.isNew ? '<span class="gym-tag tag-new">NUEVO</span>' : ''}
    </li>
  `).join('');
}

function flyTo(lat, lng, name) {
  map.flyTo([lat, lng], 15);
  gyms.find(g => g.name === name)?._marker?.openPopup();
}

function makePopup(g) {
  return `<div class="popup-content">
    <h3>${g.name}</h3>
    <p>üìç ${g.address}</p>
    <p>üïê ${g.schedule}</p>
    <p>${g.features}</p>
    ${g.distance ? `<p class="dist">üìè ${g.distance.toFixed(1)} –∫–º –æ—Ç –≤–∞—Å</p>` : ''}
    ${g.ig ? `<p><a href="https://instagram.com/${g.ig.replace('@','')}" target="_blank">Instagram ${g.ig}</a></p>` : ''}
    ${g.url ? `<p><a href="${g.url}" target="_blank">–°–∞–π—Ç</a></p>` : ''}
    ${g.phone ? `<p>üìû ${g.phone}</p>` : ''}
    <p><a href="https://www.google.com/maps/dir/?api=1&destination=${g.lat},${g.lng}" target="_blank">üó∫ –ú–∞—Ä—à—Ä—É—Ç –≤ Google Maps</a></p>
  </div>`;
}

// Add markers
gyms.forEach(g => {
  g._marker = L.marker([g.lat, g.lng], {icon: climbIcon}).addTo(map).bindPopup(makePopup(g));
});

function locateUser() {
  const btn = document.getElementById('locateBtn');
  btn.disabled = true;
  btn.textContent = '‚è≥ –û–ø—Ä–µ–¥–µ–ª—è—é...';

  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      pos => {
        userPos = { lat: pos.coords.latitude, lng: pos.coords.longitude };
        if (userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([userPos.lat, userPos.lng], {
          icon: L.divIcon({ html: 'üìç', className: '', iconSize: [24, 24], iconAnchor: [12, 12] })
        }).addTo(map).bindPopup('–í—ã –∑–¥–µ—Å—å').openPopup();
        map.flyTo([userPos.lat, userPos.lng], 13);
        updateDistances();
        // Update popups with distances
        gyms.forEach(g => g._marker.setPopupContent(makePopup(g)));
        btn.textContent = '‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
        setTimeout(() => { btn.textContent = 'üìç –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'; btn.disabled = false; }, 2000);
      },
      err => {
        btn.textContent = '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å';
        btn.disabled = false;
        setTimeout(() => { btn.textContent = 'üìç –ú–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ'; }, 2000);
      },
      { enableHighAccuracy: true, timeout: 10000 }
    );
  }
}

// --- Custom point: click on map ---
const customIcon = L.divIcon({
  html: 'üìå',
  className: 'custom-marker-pin',
  iconSize: [36, 36],
  iconAnchor: [18, 18]
});

function setCustomPoint(lat, lng, label) {
  userPos = { lat, lng };
  if (userMarker) map.removeLayer(userMarker);
  userMarker = L.marker([lat, lng], { icon: customIcon })
    .addTo(map)
    .bindPopup(label || `üìå ${lat.toFixed(4)}, ${lng.toFixed(4)}`)
    .openPopup();
  updateDistances();
  gyms.forEach(g => g._marker.setPopupContent(makePopup(g)));
  document.getElementById('locateBtn').textContent = 'üìç –û–±–Ω–æ–≤–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ';
  document.getElementById('locateBtn').disabled = false;
}

map.on('click', function(e) {
  setCustomPoint(e.latlng.lat, e.latlng.lng, `üìå –í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–æ—á–∫–∞ (${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)})`);
  document.getElementById('addressInput').value = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
});

// --- Search by address or coordinates ---
function searchAddress() {
  const input = document.getElementById('addressInput').value.trim();
  if (!input) return;

  // Try parsing as coordinates first: "-34.60, -58.43" or "-34.60 -58.43"
  const coordMatch = input.match(/^(-?\d+\.?\d*)[,\s]+(-?\d+\.?\d*)$/);
  if (coordMatch) {
    const lat = parseFloat(coordMatch[1]);
    const lng = parseFloat(coordMatch[2]);
    if (lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180) {
      map.flyTo([lat, lng], 14);
      setCustomPoint(lat, lng, `üìå ${lat.toFixed(4)}, ${lng.toFixed(4)}`);
      return;
    }
  }

  // Geocode via Nominatim
  const btn = document.querySelector('.btn-search');
  btn.textContent = '‚è≥';
  btn.disabled = true;

  fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(input + ', Buenos Aires, Argentina')}&limit=1`)
    .then(r => r.json())
    .then(results => {
      if (results.length > 0) {
        const r = results[0];
        const lat = parseFloat(r.lat);
        const lng = parseFloat(r.lon);
        map.flyTo([lat, lng], 14);
        setCustomPoint(lat, lng, `üìå ${r.display_name.split(',').slice(0, 3).join(',')}`);
        document.getElementById('addressInput').value = r.display_name.split(',').slice(0, 3).join(',').trim();
      } else {
        alert('–ê–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π —É—Ç–æ—á–Ω–∏—Ç—å.');
      }
    })
    .catch(() => alert('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞. –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.'))
    .finally(() => {
      btn.textContent = 'üîç';
      btn.disabled = false;
    });
}

// Enter key in search
document.getElementById('addressInput').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') searchAddress();
});

renderList();
</script>
</body>
</html>
